#!/bin/bash
# Calendar add via gcal (gcsa-based)
# Usage: cal_add <title> <when> [duration_hours]
# Example: cal_add "Meeting" "2026-03-01 14:00" 1

TITLE="$1"
WHEN="$2"
DURATION="${3:-1}"

if [ -z "$TITLE" ] || [ -z "$WHEN" ]; then
    echo '{"error": "Usage: cal_add <title> <when> [duration_hours]"}'
    exit 1
fi

RESULT=$(~/.local/bin/gcal add "$TITLE" "$WHEN" "$DURATION" 2>&1)
EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "{\"success\": true, \"title\": \"$TITLE\", \"when\": \"$WHEN\"}"
else
    echo "{\"error\": \"$RESULT\"}"
    exit 1
fi
