#!/bin/bash
# Email send via himalaya
# Usage: email_send <to> <subject> <body>

set -e

TO="$1"
SUBJECT="$2"
BODY="$3"

if [ -z "$TO" ] || [ -z "$SUBJECT" ]; then
    echo '{"error": "Usage: email_send <to> <subject> <body>"}'
    exit 1
fi

# Send via himalaya
RESULT=$(himalaya send <<EOF
To: $TO
Subject: $SUBJECT

$BODY
EOF
)
EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "{\"success\": true, \"to\": \"$TO\", \"subject\": \"$SUBJECT\"}"
else
    echo "{\"error\": \"$RESULT\"}"
    exit 1
fi
